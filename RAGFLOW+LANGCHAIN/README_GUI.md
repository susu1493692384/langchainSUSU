# RAGFlow GUI前端使用指南

## 概述

这是一个基于Tkinter开发的RAGFlow+LangChain图形用户界面，提供直观的问答交互体验。该GUI界面支持连接RAGFlow知识库、选择知识库、智能问答对话等功能。

## 功能特性

### 🎯 核心功能
- **RAGFlow连接管理** - 配置并连接到RAGFlow服务
- **知识库选择** - 自动获取并选择可用知识库
- **智能问答对话** - 基于选定知识库的问答交互
- **对话历史管理** - 完整的聊天记录显示和管理
- **配置管理** - 保存、加载和管理应用配置

### 🛠 界面组件
- **配置面板** - RAGFlow连接参数配置
- **知识库列表** - 动态显示可用知识库
- **聊天界面** - 实时问答对话显示
- **输入框** - 支持多行输入和快捷键操作
- **工具栏** - 对话管理和系统功能

## 安装要求

### Python环境
- Python 3.8 或更高版本

### 依赖包
```bash
pip install tkinter
pip install langchain langchain-core langchain-community
pip install langchain-openai
pip install requests python-dotenv numpy
```

### 必需文件
确保以下文件在同一目录下：
- `ragflow_gui_frontend.py` - GUI主程序
- `ragflow_langchain_integration.py` - RAGFlow集成模块

## 使用指南

### 1. 启动应用
```bash
python ragflow_gui_frontend.py
```

### 2. 配置RAGFlow连接

#### 基本配置
在左侧配置面板中设置以下参数：

- **RAGFlow服务地址**: `http://localhost:9380` (默认)
- **API密钥**: 您的RAGFlow API密钥
- **LLM模型**: `glm-4.5`、`gpt-3.5-turbo` 或 `gpt-4`
- **检索结果数量**: 1-20 (默认5)
- **相似度阈值**: 0.1-1.0 (默认0.7)

#### 配置管理
- **保存配置**: 将当前配置保存到 `gui_config.json` 文件
- **加载配置**: 从配置文件加载之前保存的设置
- **重置配置**: 恢复默认配置参数

### 3. 连接到RAGFlow

1. 配置完成后，点击 **"连接RAGFlow"** 按钮
2. 等待连接状态显示为 **"已连接"** (绿色)
3. 应用会自动获取可用的知识库列表

### 4. 选择知识库

1. 在知识库列表中选择您要查询的知识库
2. 列表会显示知识库名称、描述和文档数量
3. 使用 **"刷新知识库列表"** 按钮更新列表

### 5. 开始问答对话

#### 发送问题
1. 在底部输入框中输入您的问题
2. 使用 **Ctrl+Enter** 快捷键或点击 **"发送"** 按钮
3. 等待AI助手基于选定知识库回答问题

#### 对话记录
- **用户消息**: 蓝色显示，以"您:"开头
- **AI回复**: 绿色显示，以"AI助手:"开头
- **系统消息**: 灰色显示，以"系统:"开头
- **错误信息**: 红色显示，以"错误:"开头

### 6. 对话管理

#### 清空对话
- 点击底部工具栏的 **"清空对话"** 按钮
- 确认后清空所有聊天记录

#### 导出对话
1. 点击 **"导出对话"** 按钮
2. 选择保存位置和文件名
3. 对话记录将保存为文本文件(.txt)

## 界面布局

### 左侧面板
```
┌─────────────────────┐
│  RAGFlow配置        │
│ ├─ 服务地址         │
│ ├─ API密钥          │
│ ├─ LLM模型          │
│ ├─ 检索参数         │
│ └─ 配置按钮         │
├─────────────────────┤
│ 连接状态和按钮      │
├─────────────────────┤
│  知识库选择         │
│ └─ 知识库列表       │
└─────────────────────┘
```

### 右侧面板
```
┌─────────────────────────┐
│      问答对话           │
│ ┌─────────────────────┐ │
│ │                     │ │
│ │   聊天记录显示区    │ │
│ │                     │ │
│ └─────────────────────┘ │
├─────────────────────────┤
│      输入框             │
│ ┌─────────────────────┐ │
│ │  [问题输入区域]     │ │
│ │              [发送] │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

## 快捷键

- **Ctrl+Enter**: 发送消息
- **Esc**: 关闭对话框
- **F5**: 刷新知识库列表 (某些情况下)

## 错误处理

### 常见错误及解决方案

#### 1. 连接失败
```
错误: 连接RAGFlow失败
```
**解决方案**:
- 检查RAGFlow服务是否运行 (默认端口9380)
- 验证API密钥是否正确
- 确认网络连接正常

#### 2. 知识库获取失败
```
错误: 获取知识库列表失败
```
**解决方案**:
- 确认RAGFlow中已创建知识库
- 检查API权限设置
- 尝试刷新知识库列表

#### 3. 问答失败
```
错误: 回答问题时出错
```
**解决方案**:
- 确保已选择知识库
- 检查LLM配置和API密钥
- 验证知识库中是否有相关文档

#### 4. 模块导入错误
```
错误: 无法导入RAGFlow集成模块
```
**解决方案**:
- 确认 `ragflow_langchain_integration.py` 文件存在
- 检查Python路径设置
- 安装所需依赖包

## 配置文件

### gui_config.json
```json
{
  "ragflow_url": "http://localhost:9380",
  "ragflow_api_key": "your_api_key",
  "llm_model": "glm-4.5",
  "top_k": 5,
  "similarity_threshold": 0.7
}
```

配置文件会自动保存在应用运行目录下，包含以下字段：
- `ragflow_url`: RAGFlow API服务地址
- `ragflow_api_key`: API认证密钥
- `llm_model`: 使用的LLM模型
- `top_k`: 检索结果数量
- `similarity_threshold`: 相似度阈值

## 性能优化建议

### 1. 连接优化
- 使用稳定的网络连接
- 设置合适的超时时间
- 定期测试连接状态

### 2. 知识库优化
- 选择相关度高的知识库
- 合理设置检索参数
- 定期更新知识库内容

### 3. 对话管理
- 定期清空不必要的对话记录
- 导出重要的对话内容
- 避免一次发送过长的问题

## 扩展功能

### 自定义主题
可以通过修改Tkinter样式来自定义界面外观：

```python
style = ttk.Style()
style.theme_use('clam')  # 或其他主题
```

### 多语言支持
界面文本主要使用中文，可以轻松扩展为多语言支持。

### 插件系统
可以添加插件支持更多功能，如：
- 语音输入输出
- 图片识别
- 文件上传
- 更多LLM模型支持

## 故障排除

### 日志信息
应用会在聊天窗口中显示详细的操作日志，包括：
- 连接状态变化
- 错误信息
- 系统提示

### 调试模式
如需更详细的调试信息，可以在代码中添加日志输出。

### 技术支持
如遇到问题，请检查：
1. Python版本是否符合要求
2. 依赖包是否正确安装
3. RAGFlow服务是否正常运行
4. 网络连接是否稳定

## 更新日志

### v1.0
- 初始版本发布
- 基本的GUI界面和功能
- RAGFlow连接和知识库选择
- 问答对话功能
- 配置管理和对话导出

## 许可证

本GUI前端基于原有的RAGFlow+LangChain集成方案开发，遵循相同的许可证条款。