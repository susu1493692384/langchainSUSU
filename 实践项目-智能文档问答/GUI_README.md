# 🤖 智能文档问答系统 GUI版

一个基于LangChain和CustomTkinter的现代化智能文档问答系统，具备智能记忆管理、动态文档检索和多轮对话理解能力。

## ✨ 主要特性

### 🧠 智能记忆管理
- **对话上下文理解**: 自动维护对话历史，理解引用和省略
- **智能记忆节点**: 基于重要性评分的记忆管理系统
- **话题权重追踪**: 动态追踪和衰减话题权重
- **实体关系图谱**: 构建和维护实体间的关系网络

### 📊 动态文档检索
- **TF-IDF算法**: 基于词频-逆文档频率的智能检索
- **动态相关性评分**: 结合上下文和历史的智能评分
- **文档分块处理**: 智能分割和索引文档内容
- **多格式支持**: 支持文本文件的上传和处理

### 💬 多轮对话理解
- **引用消解**: 自动解析代词和引用关系
- **上下文连贯**: 保持多轮对话的逻辑一致性
- **智能问答**: 基于检索到的文档内容生成准确回答
- **对话历史**: 完整保存和导出对话记录

### 🖥️ 现代化界面
- **卡片式布局**: 直观清晰的模块化界面设计
- **明暗主题**: 支持明暗主题切换
- **实时监控**: 系统状态和性能指标实时显示
- **响应式设计**: 灵活适应不同屏幕尺寸

## 🚀 快速开始

### 1. 环境要求
- Python 3.8+
- pip包管理器
- 有效的API密钥（用于LLM）

### 2. 安装依赖

运行自动安装脚本：
```bash
python install_requirements.py
```

或手动安装：
```bash
pip install customtkinter langchain-openai langchain-core python-dotenv openai tiktoken
```

### 3. 配置环境

编辑 `.env` 文件，设置您的API配置：
```env
GLM_API_KEY=your_api_key_here
GLM_BASE_URL=https://open.bigmodel.cn/api/paas/v4/
```

### 4. 启动应用

启动GUI版本：
```bash
python document_qa_gui.py
```

或运行命令行版本：
```bash
python 文档问答系统.py
```

## 📋 使用指南

### 界面布局

```
┌─────────────────────────────────────────────────────────────────┐
│                        标题栏 (Header)                          │
│ 🤖 智能文档问答系统           [🌙主题] [⚙️设置] [❓帮助]          │
├─────────────────────────────────────────────────────────────────┤
│  文档管理卡片    │          对话交互卡片          │   系统监控卡片   │
│ 📁 文档列表      │    💬 智能对话历史           │ 📊 记忆系统统计  │
│ 📤 上传文档      │                             │ 🏷️ 当前话题权重  │
│ 👁️ 文档预览      │    [用户] 请问...            │ 🕸️ 实体关系图谱  │
│ ⚙️ 文档设置      │    [AI] 根据文档内容...      │ ⚡ 性能指标监控  │
│                 │                             │                 │
├─────────────────────────────────────────────────────────────────┤
│                     输入卡片 (Input Card)                       │
│ 📝 请输入您的问题 [🚀发送] [🗑️清空]              字数: 0/500    │
├─────────────────────────────────────────────────────────────────┤
│                        状态栏 (Footer)                          │
│ 🟢 系统就绪      智能文档问答系统 v1.0      2024-01-01 12:00   │
└─────────────────────────────────────────────────────────────────┘
```

### 文档管理
1. **上传文档**: 点击"上传文档"按钮，选择.txt文件
2. **文档预览**: 点击文档列表中的"👁️"按钮预览内容
3. **文档设置**: 调整分块大小和检索参数
4. **自动索引**: 文档上传后自动创建TF-IDF索引

### 智能对话
1. **输入问题**: 在底部输入框中输入您的问题
2. **发送消息**: 点击"发送问题"按钮或按Ctrl+Enter
3. **查看回答**: AI会基于文档内容提供智能回答
4. **多轮对话**: 可以继续提问，系统会理解对话上下文

### 系统监控
1. **记忆统计**: 查看记忆节点数量和系统状态
2. **话题权重**: 实时显示当前活跃话题
3. **实体图谱**: 查看实体关系网络
4. **性能指标**: 监控系统性能和使用情况

### 高级功能
1. **主题切换**: 点击顶部"🌙/☀️"按钮切换明暗主题
2. **系统设置**: 点击"⚙️"按钮打开配置面板
3. **导出对话**: 点击"💾 导出"保存对话历史
4. **查看帮助**: 点击"❓ 帮助"查看详细说明

## ⌨️ 快捷键

- `Ctrl+Enter`: 发送消息
- `Esc`: 清空输入框
- `F1`: 显示帮助

## 🎯 使用技巧

### 获得更好的回答
1. **具体问题**: 提供清晰、具体的问题描述
2. **相关文档**: 确保上传的文档内容相关且完整
3. **分步提问**: 对于复杂问题，可以分步骤提问
4. **引用上下文**: 可以引用之前讨论的内容

### 提高系统性能
1. **合理分块**: 根据文档内容调整分块大小
2. **定期清理**: 定期清理不需要的记忆节点
3. **文档优化**: 确保文档格式清晰、结构合理
4. **参数调优**: 在设置中调整系统参数

### 监控和维护
1. **查看统计**: 定期查看系统统计信息
2. **监控性能**: 关注响应时间和内存使用
3. **备份对话**: 定期导出重要的对话历史
4. **更新文档**: 及时更新和补充文档内容

## 🔧 系统架构

### 核心组件

1. **IntelligentDocumentQA**: 主问答系统
   - 集成记忆管理和文档检索
   - 处理多轮对话和上下文理解
   - 生成智能回答和更新记忆

2. **IntelligentMemoryManager**: 智能记忆管理
   - 记忆节点管理和重要性评分
   - 话题追踪和权重衰减
   - 实体图谱构建和维护

3. **TFIDFRetriever**: 文档检索器
   - TF-IDF索引构建和查询
   - 文档相似度计算
   - 多文档排序和检索

4. **EnhancedDocumentRetriever**: 增强检索器
   - 动态相关性评分
   - 上下文感知检索
   - 历史引用追踪

### 数据流

```
用户问题 → 引用消解 → 文档检索 → 动态评分 → 回答生成 → 记忆更新
    ↓           ↓           ↓           ↓           ↓           ↓
对话历史 → 上下文解析 → TF-IDF匹配 → 评分计算 → LLM推理 → 记忆存储
```

## 📊 性能指标

### 系统监控指标
- **记忆节点数**: 当前存储的记忆节点数量
- **活跃话题数**: 当前追踪的话题数量
- **实体图谱大小**: 实体关系网络的规模
- **对话轮次**: 进行的对话轮次统计
- **文档数量**: 已加载和索引的文档数

### 性能优化
- **索引效率**: TF-IDF索引构建和查询速度
- **内存使用**: 记忆管理器的内存占用
- **响应时间**: 问题处理和回答生成时间
- **准确率**: 文档检索和回答准确度

## 🛠️ 自定义配置

### 记忆管理配置
```python
memory_manager = IntelligentMemoryManager(
    max_memory_nodes=50,        # 最大记忆节点数
    importance_threshold=0.3    # 重要性阈值
)
```

### 文档检索配置
```python
splitter = RecursiveCharacterTextSplitter(
    chunk_size=300,             # 分块大小
    chunk_overlap=50,           # 重叠字符数
    length_function=len         # 长度计算函数
)
```

### LLM配置
```python
llm = ChatOpenAI(
    model="glm-4.6",           # 模型名称
    temperature=0.7,           # 创造性参数
    openai_api_key="your_key",
    openai_api_base="your_base_url"
)
```

## 🔍 故障排除

### 常见问题

**Q: 无法启动应用**
A: 检查Python版本是否为3.8+，确保所有依赖已正确安装

**Q: API密钥错误**
A: 检查.env文件中的API密钥和基础URL配置是否正确

**Q: 文档加载失败**
A: 确保文档格式为.txt，编码为UTF-8，且文件路径正确

**Q: 回答不准确**
A: 检查文档内容是否相关，问题描述是否清晰，尝试调整检索参数

**Q: 界面显示异常**
A: 尝试切换主题，确保CustomTkinter版本兼容

### 错误日志

应用运行时会在控制台输出详细日志，包括：
- 初始化信息
- 文档加载状态
- 问题处理过程
- 错误信息和堆栈

如遇问题，请查看控制台输出获取详细错误信息。

## 📈 更新日志

### v1.0.0 (当前版本)
- ✨ 完整的GUI界面实现
- ✨ 智能记忆管理系统
- ✨ 动态文档检索功能
- ✨ 多轮对话理解
- ✨ 实时系统监控
- ✨ 主题切换支持
- ✨ 对话历史导出
- ✨ 完整的帮助文档

### 计划功能
- 🔄 更多文档格式支持 (PDF, DOCX)
- 🔄 语音输入输出
- 🔄 插件系统
- 🔄 云端同步
- 🔄 多语言支持

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境设置
1. 克隆仓库
2. 运行 `python install_requirements.py --optional` 安装开发依赖
3. 配置开发环境
4. 创建功能分支进行开发

### 代码规范
- 使用Python 3.8+语法
- 遵循PEP 8编码规范
- 添加适当的注释和文档字符串
- 编写单元测试

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 📞 联系支持

如有问题或建议，请通过以下方式联系：

- 📧 邮箱: [your-email@example.com]
- 🐛 问题反馈: [GitHub Issues]
- 💬 讨论区: [GitHub Discussions]

---

**感谢使用智能文档问答系统！** 🎉

如果这个项目对您有帮助，请给我们一个 ⭐ Star！